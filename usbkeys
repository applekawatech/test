# /etc/initcpio/hooks/usbkeys

run_hook() {
    # USBデバイスをマウントポイントにマウントするためのディレクトリを作成
    mkdir -p /mnt/usbkey

    # すべてのUSBデバイスをスキャンしてマウント
    for dev in /dev/disk/by-id/usb*; do
        mount -t auto "$dev" /mnt/usbkey 2>/dev/null
        if [ $? -eq 0 ]; then
            echo "USB key mounted at /mnt/usbkey"
            break
        fi
    done

    # キーファイルを探してコピー
    if [ -f /mnt/usbkey/Ilovemasa.py ]; then
        cp /mnt/usbkey/Ilovemasa.py /tmp/Ilovemasa.py
    else
        echo "Key file not found on USB key"
        exit 1
    fi

    # マウント解除
    umount /mnt/usbkey
}
