#!/bin/bash

run_hook() {
    echo "Running usbkeys hook..."

    # Create mount point directory
    mkdir -p /mnt/usbkey

    # Scan and mount all USB devices
    for dev in /dev/disk/by-id/usb*; do
        echo "Trying to mount USB device: $dev"
        mount -t auto "$dev" /mnt/usbkey 2>/dev/null
        if [ $? -eq 0 ]; then
            echo "USB key mounted at /mnt/usbkey"
            break
        else
            echo "Failed to mount: $dev"
        fi
    done

    if mountpoint -q /mnt/usbkey; then
        # Copy the key file if found
        if [ -f /mnt/usbkey/Ilovemasa.py ]; then
            echo "Key file found, copying to /tmp..."
            cp /mnt/usbkey/Ilovemasa.py /tmp/Ilovemasa.py
        else
            echo "Key file not found on USB key"
            exit 1
        fi

        # Unmount USB key
        echo "Unmounting USB key..."
        umount /mnt/usbkey
    else
        echo "No USB key mounted"
        exit 1
    fi
}
